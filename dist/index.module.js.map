{"version":3,"file":"index.module.js","sources":["../../src/scrollListener.js","../../src/index.js","../../node_modules/@compactjs/cap/dist/index.module.js"],"sourcesContent":["let attached = false;\nconst scrollCallbacks = new Set();\nconst eventListener = (event) => {\n\tscrollCallbacks.forEach((callback) => {\n\t\tcallback(event);\n\t});\n};\nconst attach = () => {\n\twindow.addEventListener('scroll', eventListener);\n\tattached = true;\n};\nconst destroy = () => {\n\twindow.removeEventListener('scroll', eventListener);\n\tattached = false;\n};\nexport const scrollListener = {\n\tadd(callback) {\n\t\tscrollCallbacks.add(callback);\n\t\tif (!attached) attach();\n\t},\n\tremove(callback) {\n\t\tscrollCallbacks.delete(callback);\n\t\tif (attached && scrollCallbacks.size === 0) destroy();\n\t},\n};\n","import { scrollListener } from './scrollListener';\nimport { cap } from '@compactjs/cap';\n\nexport const onStage = (actors, options) => {\n\tconst _elements =\n\t\ttypeof actors === 'string'\n\t\t\t? Array.from(document.querySelectorAll(actors))\n\t\t\t: Array.isArray(actors)\n\t\t\t? actors\n\t\t\t: [actors];\n\n\tconst onStageCallstack = [];\n\tconst leaveStageCallstack = [];\n\n\tconst observer = new IntersectionObserver((entries) => {\n\t\tentries.forEach((entry) => {\n\t\t\tif (entry.intersectionRatio > 0) {\n\t\t\t\tonStageCallstack.forEach((c) => c(entry.target));\n\t\t\t\tif (leaveStageCallstack.length <= 0) {\n\t\t\t\t\tobserver.unobserve(entry.target);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tleaveStageCallstack.forEach((c) => c(entry.target));\n\t\t\t}\n\t\t});\n\t}, options);\n\n\t_elements.forEach((element) => {\n\t\tobserver.observe(element);\n\t});\n\n\tconst api = (stack) => {\n\t\treturn {\n\t\t\taddClass(className) {\n\t\t\t\tstack.push((e) => e.classList.add(className));\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tremoveClass(className) {\n\t\t\t\tstack.push((e) => e.classList.remove(className));\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\ttoggle(className) {\n\t\t\t\tif (stack === onStageCallstack) {\n\t\t\t\t\tonStageCallstack.push((e) => e.classList.add(className));\n\t\t\t\t\tleaveStageCallstack.push((e) => e.classList.remove(className));\n\t\t\t\t} else {\n\t\t\t\t\tleaveStageCallstack.push((e) => e.classList.add(className));\n\t\t\t\t\tonStageCallstack.push((e) => e.classList.remove(className));\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tdo(fun) {\n\t\t\t\tstack.push(fun);\n\t\t\t\treturn this;\n\t\t\t},\n\t\t\tend() {\n\t\t\t\tstack.push(() => observer.disconnect());\n\t\t\t\treturn this;\n\t\t\t},\n\t\t};\n\t};\n\n\treturn {\n\t\t...api(onStageCallstack),\n\t\tonScrollProgress(callback) {\n\t\t\tonStageCallstack.push((element) => {\n\t\t\t\tconst windowHeight = document.documentElement.clientHeight;\n\t\t\t\tconst startVisible = element.offsetTop - windowHeight;\n\t\t\t\tconst endVisible = element.offsetTop + element.offsetHeight;\n\n\t\t\t\tconst distance = endVisible - startVisible;\n\n\t\t\t\tconst scrollCallback = () => {\n\t\t\t\t\tconst currentRelativeScroll =\n\t\t\t\t\t\t(window.pageYOffset || document.documentElement.scrollTop) -\n\t\t\t\t\t\tstartVisible;\n\n\t\t\t\t\tconst progress = currentRelativeScroll / distance;\n\n\t\t\t\t\tcallback(cap(progress, 0, 1), element);\n\t\t\t\t};\n\t\t\t\telement.scrollCallback = scrollCallback;\n\t\t\t\tscrollListener.add(scrollCallback);\n\t\t\t\tscrollCallback();\n\t\t\t});\n\t\t\tleaveStageCallstack.push((element) => {\n\t\t\t\tif (element.scrollCallback)\n\t\t\t\t\tscrollListener.remove(element.scrollCallback);\n\t\t\t});\n\t\t\treturn this;\n\t\t},\n\t\telse: {\n\t\t\t...api(leaveStageCallstack),\n\t\t},\n\t};\n};\n","var r=function(r,t,a){if(void 0===a)return Math.min(r,t);if(a<t){var i=[a,t];t=i[0],a=i[1]}return Math.min(Math.max(r,t),a)};export{r as cap};\n//# sourceMappingURL=index.module.js.map\n"],"names":["attached","scrollCallbacks","Set","eventListener","event","forEach","callback","onStage","actors","options","_elements","Array","from","document","querySelectorAll","isArray","onStageCallstack","leaveStageCallstack","observer","IntersectionObserver","entries","entry","intersectionRatio","c","target","length","unobserve","element","observe","api","stack","addClass","className","push","e","classList","add","removeClass","remove","toggle","fun","end","disconnect","onScrollProgress","windowHeight","documentElement","clientHeight","startVisible","offsetTop","distance","offsetHeight","scrollCallback","currentRelativeScroll","window","pageYOffset","scrollTop","r","t","a","Math","min","i","max","cap","addEventListener","scrollListener","size","removeEventListener","else"],"mappings":"+MAAA,IAAIA,GAAW,EACTC,EAAkB,IAAIC,IACtBC,EAAgB,SAACC,GACtBH,EAAgBI,QAAQ,SAACC,GACxBA,EAASF,MCDEG,EAAU,SAACC,EAAQC,GAC/B,IAAMC,EACa,iBAAXF,EACJG,MAAMC,KAAKC,SAASC,iBAAiBN,IACrCG,MAAMI,QAAQP,GACdA,EACA,CAACA,GAECQ,EAAmB,GACnBC,EAAsB,GAEtBC,EAAW,IAAIC,qBAAqB,SAACC,GAC1CA,EAAQf,QAAQ,SAACgB,GACZA,EAAMC,kBAAoB,GAC7BN,EAAiBX,QAAQ,SAACkB,UAAMA,EAAEF,EAAMG,UACpCP,EAAoBQ,QAAU,GACjCP,EAASQ,UAAUL,EAAMG,SAG1BP,EAAoBZ,QAAQ,SAACkB,UAAMA,EAAEF,EAAMG,aAG3Cf,GAEHC,EAAUL,QAAQ,SAACsB,GAClBT,EAASU,QAAQD,KAGlB,IAAME,EAAM,SAACC,GACZ,MAAO,CACNC,kBAASC,GAER,OADAF,EAAMG,KAAK,SAACC,UAAMA,EAAEC,UAAUC,IAAIJ,WAGnCK,qBAAYL,GAEX,OADAF,EAAMG,KAAK,SAACC,UAAMA,EAAEC,UAAUG,OAAON,WAGtCO,gBAAOP,GAQN,OAPIF,IAAUd,GACbA,EAAiBiB,KAAK,SAACC,UAAMA,EAAEC,UAAUC,IAAIJ,KAC7Cf,EAAoBgB,KAAK,SAACC,UAAMA,EAAEC,UAAUG,OAAON,OAEnDf,EAAoBgB,KAAK,SAACC,UAAMA,EAAEC,UAAUC,IAAIJ,KAChDhB,EAAiBiB,KAAK,SAACC,UAAMA,EAAEC,UAAUG,OAAON,wBAI/CQ,GAEF,OADAV,EAAMG,KAAKO,SAGZC,eAEC,OADAX,EAAMG,KAAK,kBAAMf,EAASwB,uBAM7B,YACIb,EAAIb,IACP2B,0BAAiBrC,GAyBhB,OAxBAU,EAAiBiB,KAAK,SAACN,GACtB,IAAMiB,EAAe/B,SAASgC,gBAAgBC,aACxCC,EAAepB,EAAQqB,UAAYJ,EAGnCK,EAFatB,EAAQqB,UAAYrB,EAAQuB,aAEjBH,EAExBI,EAAiB,WACtB,IAAMC,GACJC,OAAOC,aAAezC,SAASgC,gBAAgBU,WAChDR,EAIDzC,EC/EC,SAASkD,EAAEC,EAAEC,GAAG,QAAG,IAASA,EAAE,OAAOC,KAAKC,IAAIJ,EAAEC,GAAG,GAAGC,EAAED,EAAE,CAAC,IAAII,EAAE,CAACH,EAAED,GAAGA,EAAEI,EAAE,GAAGH,EAAEG,EAAE,GAAG,OAAOF,KAAKC,IAAID,KAAKG,IAAIN,EAAEC,GAAGC,GD+E3GK,CAFQX,EAAwBH,EAElB,EAAG,GAAItB,IAE/BA,EAAQwB,eAAiBA,WDjExB7C,GACHL,EAAgBmC,IAAI9B,GACfN,IAVNqD,OAAOW,iBAAiB,SAAU7D,GAClCH,GAAW,GCyERiE,CAAmBd,GACnBA,MAEDlC,EAAoBgB,KAAK,SAACN,GACrBA,EAAQwB,yBDlER7C,GACNL,SAAuBK,GACnBN,GAAqC,IAAzBC,EAAgBiE,OAVjCb,OAAOc,oBAAoB,SAAUhE,GACrCH,GAAW,GC0EPiE,CAAsBtC,EAAQwB,wBAIjCiB,UACIvC,EAAIZ"}